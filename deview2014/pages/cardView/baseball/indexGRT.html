<!DOCTYPE html>
<html>
    <head>
        <title>BaseBall</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
          <style>
            .gameContainer {width: 640px; height:480px;}
            canvas {border: 1px solid black;}
        </style>

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
       <script src="js/baseballSimulator.js"></script>
       <script src="js/sceneManager.js"></script>
       <script src="js/intro.js"></script>
       <script src="js/sprite.js"></script>
       <script type="text/javascript" src="./gameRunTimeGuest.js"></script>
    </head>
    <body>
       <div class="gameContainer">
        <canvas width="640" height="480" id="canvas" style="position:absolute; top:0; left:0"></canvas>
    </div>
    <div id="info"></div>
        <script>
        var gameInst;
        var gameSetting;
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        if( typeof gameRunTimeGuest !== "undefined" ){
            gameRunTimeGuest.setStatusCB({
                startCB: function(){
                    //Simulation서버에 접근해서 초기화 수행
                    console.log("connecting to the simulation server");
                    // gameInst.gameEndCB = $.proxy( gameRunTimeGuest.onEnd, gameRunTimeGuest );
                    //wait to join the simulation server
                    gameRunTimeGuest.onWaiting();
                    setTimeout(function(){
                        //Game을 시작
                         gameInst = new intro(canvas,gameSetting);
                        //시작되었음을 host에게 알림
                        gameRunTimeGuest.onStarted();
                    }, 500); //예제로 2초간 가짜로 기다렸다가 게임을 실제 시작
                },
                endCB: function(){
                    //갑자기 종료함
                    console.log("game is terminated by someone");
                },
                screenShotCB: function(){
                    return gameInst.captureScreenShot();
                },
                setGameResolutionCB: function( data ){
                    console.log("Set Resolution: " + data);
                    $(canvas).css(JSON.parse(data));
                    return;
                },
                getGameResolutionCB: function(){
                    return JSON.stringify({
                        mid: {width: 320, height: 240},
                        high: {width:640, height: 480}
                    });
                },
                scaleCanvasCB: function(xScale, yScale){
                    //CSS scaling
                    $(canvas).css({
                        width: $(canvas).width()*xScale,
                        height: $(canvas).height()*yScale
                    });
                    //scaling filter
                    $(canvas).css("image-rendering", "-webkit-optimize-contrast");
                    //event translation
                    gameInst.setSizeScale( xScale, yScale );
                },
                gameCustomDataCB: function( data ){
                    var obj = JSON.parse(data);
                    gameSetting = $.extend(gameSetting, obj);
                }
            });
        }

        $(document).ready(function() {
            if( typeof gameRunTimeGuest !== "undefined" ){
                //resource loading is completed
                gameRunTimeGuest.onReady();
            }
        });
        </script>
    </body>
</html>