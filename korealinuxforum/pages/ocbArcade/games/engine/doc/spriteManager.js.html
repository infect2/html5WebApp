<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pwge/spriteManager.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: pwge/spriteManager.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>define("pwge/spriteManager", ["pwge/canvas", "util/easing", "pwge/util"], function(canvas, easing, util){
    var spriteMap = {},
        /**
         * sprite 모듈
         * &lt;br>Entity에 적용될 이미지나 스프라이트애니메이션을 설정한다.
         * @exports pwge/spriteManager
         * @requires pwge/canvas
         * @requires pwge/easing
         * @requires pwge/util
         */
        spriteManager = {},
        Sprite;

    /**
     * Sprite 객체
     * 직접생성하여 쓰지 않고 spriteManager 모듈을 통해 사용한다.
     * @class
     * @param  {String} name 이름
     * @param  {HTMLImageElement} image 스프라이트 이미지 엘리먼트
     * @param  {Object} options 설정옵션객체
     *
     * @example
     * spriteManager.set(name, image, options);
     */
    Sprite = function(name, image, options){
        var i;

        this.name = name;
        this.image = image;

        this.options = util.extend({
            loop : false,
            repeat : 1,
            duration : 0,
            sleep : 0,
            order : [],
            easing : "linear"
        }, options);
        this.x = this.options.x;
        this.y = this.options.y;
        this.width = this.options.width;
        this.height = this.options.height;
        this.lastAwake = 0;

        if (!this.options.order.length) {
            for (i = 0; i &lt; this.options.frames; i++) {
                this.options.order.push(i);
            }
        }

        this.uniqueFrames = [];
        this.options.order.forEach(function(v){
            if (this.options.order.indexOf(v) > -1 &amp;&amp; this.uniqueFrames.indexOf(v) &lt; 0) {
                this.uniqueFrames.push(v);
            }
        }, this);
    };

    /**
     * @private
     * @param  {Number} dt 타임라인 진행시간
     */
    Sprite.prototype.draw = function(dt) {
        var image = this.sprite.image,
            sx = this.sprite.x + this.sprite._getCurrentFrame(dt) * this.sprite.width,
            sy = this.sprite.y,
            sw = this.sprite.width,
            sh = this.sprite.height,
            dx = this.owner.x + this.x,// - this.anchorX,
            dy = this.owner.x + this.y,// - this.anchorY,
            dw = this.width,
            dh = this.height;

        this.drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh);
    };

    /**
     * 스프라이트의 특정 프레임을 image로 불러온다.
     * @param  {Number} frameNo 프레임 번호 (0~)
     * @return {HTMLCanvasElement}
     * @example
     * entityPool.allocate({
     *     x : 50,
     *     y : 200,
     *     width : 340,
     *     height : 235
     * }).setBaseImage(spriteManager.get("spriteName").getFrameAsImage(0));
     */
    Sprite.prototype.getFrameAsImage = function(frameNo) {
        var ctx = canvas.offscreen().getContext("2d");
        ctx.drawImage(this.image,
            this.x + this.width * frameNo,
            this.y,
            this.width,
            this.height,
            this.x,
            this.y,
            this.width,
            this.height
        );
        return ctx.canvas;
    };

    Sprite.prototype._getCurrentFrame = function(dt) {
        if (this.options.frames === 1) {
            return 0;
        }

        dt = Math.max(0, dt);

        if (!this.options.loop &amp;&amp; dt > (this.options.duration + this.options.sleep) * this.options.repeat) {
            return this.options.order[this.options.order.length - 1];
        }
        return this.options.order[Math.min(this.options.order.length - 1, Math.floor(easing[this.options.easing](dt % (this.options.duration + this.options.sleep), 0, this.options.order.length, this.options.duration)))];
    };

    /**
     * Sprite 객체를 가져온다.
     * @param  {String} name 이름
     * @return {Object}
     */
    spriteManager.get = function(name) {
        return spriteMap[name];
    };

    /**
     * Sprite 객체를 생성하여 설정한다.
     * @param  {String} name 이름
     * @param  {HTMLImageElement} image 스프라이트 이미지 엘리먼트
     * @param  {Object} options 설정옵션객체. 애니메이션이 없는 고정 이미지인경우 생략가능하다.
     * @return {sprite}
     * @example
     * //애니메이션이 없는 한장의 이미지를 엔티티에 적용하는 예제
     * spriteManager.set("imageName", image);
     * entityPool.allocate({
     *     x : 50,
     *     y : 200,
     *     width : 340,
     *     height : 235
     * }).setBaseSprite("imageName");
     */
    spriteManager.set = function(name, image, options) {
        spriteMap[name] = new Sprite(name, image, options || { x : 0, y : 0, width : image.width, height : image.height, frames : 1 });
        return this;
    };

    return spriteManager;
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="boardManager.html">pwge/boardManager</a></li><li><a href="boardPool.html">pwge/boardPool</a></li><li><a href="canvas.html">pwge/canvas</a></li><li><a href="config.html">pwge/config</a></li><li><a href="entityPool.html">pwge/entityPool</a></li><li><a href="input.html">pwge/input</a></li><li><a href="loader.html">pwge/loader</a></li><li><a href="renderer.html">pwge/renderer</a></li><li><a href="sound.html">pwge/sound</a></li><li><a href="spriteManager.html">pwge/spriteManager</a></li><li><a href="util.html">pwge/util</a></li><li><a href="easing.html">util/easing</a></li><li><a href="ObjectPool.html">util/ObjectPool</a></li><li><a href="PubSub.html">util/PubSub</a></li></ul><h3>Classes</h3><ul><li><a href="boardPool-Board.html">Board</a></li><li><a href="entityPool-Entity.html">Entity</a></li><li><a href="spriteManager-Sprite.html">Sprite</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha2</a> on Thu Feb 06 2014 11:24:18 GMT+0900 (KST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
