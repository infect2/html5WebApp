<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <title>HTML5 게임</title>
    <link href="css/impress-demo.css" rel="stylesheet" />
    <script src="js/jquery-1.8.0.js"></script>
    <script src="js/clock.js"></script>
</head>

<body class="impress-not-supported">

<div id="impress">

    <div id="cover" class="step" data-x="-3500" data-y="-1500" data-rotate="15" data-scale="5">
        <div>모바일용 HTML5 게임 성능 최적화</div>
        <div class="flipX" style="font-size:35px">&lt앱 세상에서 HTML5 생존기&gt</div>
        <img class="positioning" src="./img/html5Planet.png">
        <img id="canvasLogo" src="./img/canvasLogo.png">
    </div>

    <div id="demo1" class="step" data-x="-3800" data-y="-2000" data-rotate="15" data-scale="0.5">
        <div style="font-size:65px">Click의 <span style="font-size:85px">Web 시대</span>가 지고</div>
        <div style="font-size:65px">Touch의 <span style="font-size:85px">앱 천지</span>가 되다.</div>
    </div>

    <div id="demo2" class="step" data-x="-3000" data-y="-1500" data-rotate="90" data-scale="0.1">
        <div>Hybrid App에서</div>
        <div><span style="font-size:85px">상리 공생 전략</span>  <br>을 통해서 생존해 나가자</div>
    </div>

    <div id="question3" class="step" data-x="-3502" data-y="-1501" data-rotate-y="180" data-scale="0.001">
        <img width="270px" height="560" src="./img/cubeArcade.png">
        <img width="270px" src="./img/ocbArcadePromo.png">
        <img width="250px" src="./img/syrup-plantpop.png">
        <div style="font-size:25px">데모앱 설치: Google Play/T Store에서 OK 캐쉬백으로 검색 후 설치</div>
    </div>

    <div id="question4" class="step" data-x="-3504" data-y="-1502" data-rotate="90" data-scale="0.001">
        <div style="font-size:55px">OK 캐쉬백 오락실 기술 Overview</div>
        <div style="font-size:45px">- Web UI: CSS3D, keyframe animation</div>
        <div style="font-size:45px">- Game: Canvas/DOM Hybrid</div>
        <div style="font-size:45px">- Webview: OK 캐쉬백 App Embedded</div>
        <div style="font-size:45px">- OS: Android 2.3 이상, iOS </div>
    </div>

    <div id="slideCanvas" class="step slide" data-x="-500" data-y="-1500" data-rotate-x="90">
        <h1 class="title">서비스 관점 HTML5 활용도 </h1>
        <div class="content">
            <ol>
                <li> WebView를 통한 Hybrid App의 일반화
                    <ul>
                        <li>
                            사업/기획팀등 비 개발자도 Hybrid App의 장점을 이해
                        </li>
                    </ul>
                </li>
                <li> No App Update
                    <ul>
                        <li>
                            사용자 App update 저항감 회피
                        </li>
                        <li>
                            App Store를 통한 서비스 배포 지연 위험성 회피
                        </li>
                    </ul>
                </li>
                <li> iOS/Android One Source 배포
                    <ul>
                        <li>
                            개발, 운영 비용 효율화
                        </li>
                    </ul>
                </li>

            </ol>
        </div>
    </div>

    <div id="osMSShare" class="step slide" data-x="0" data-y="-500" data-rotate-y="90">
        <h1 class="title">상품화 수준 정의</h1>
        <div class="content">
            <ol>
                <li>
                    모든 고객 만족: Android 2.3x 이상, iOS 5.0 이상 지원
                </li>
            </ol>
            <div style="font-size:20px;padding-left:250px">OK 캐쉬백 앱: Mobile OS Share</div>
            <img style="padding-left:50px" height="450px" src="./img/mobileOSShare.png">
        </div>
    </div>

    <div id="webPlatform" class="step slide" data-x="0" data-y="-500">
        <h1 class="title">상품화 수준 HTML5 개발을 위한 필수 지식</h1>
        <div class="content">
            <ol>
                <li>
                    WebKit 내부 동작: DOM/Render Tree 복잡도 관리/GPU 활용
                </li>
                <li>
                    개발 환경: Chrome Inspector 활용
                </li>
                <li>
                    Fragmentation의 이해 및 대처
                </li>
                <li>
                    요구사항의 기술적인 구현 가능성 판단하기
                </li>
            </ol>
        </div>
    </div>

    <div id="webkitFunction" class="step slide" data-x="1000" data-y="0">
        <h1 class="title">Webkit 엔진 주요 기능 (Blink 포함) </h1>
        <div class="content">
            <ol>
                <li> Parsing(HTML, XML, CSS, JavaScript)</li>
                <li> Layout </li>
                <li> Text, graphics rendering </li>
                <li> Image decoding </li>
                <li> GPU interaction </li>
                <li> Network access </li>
                <li> HW acceleration </li>
            </ol>
        </div>
    </div>

    <div id="treeExample" class="step slide" data-x="2000" data-y="0">
        <h1 class="title">WebKit 내부 Tree: HTML/CSS Parsing</h1>
        <div class="content">
            <img width="100%" src="img/treeExample.png">
        </div>
    </div>

    <div id="treeBasics" class="step slide" data-x="3000" data-y="0">
        <h1 class="title">WebKit 내부 Tree: Parsing 후 HTML/CSS 내부 표현 </h1>
        <div class="content">
            <ol>
                <li> DOM tree: <span style="font-size:20px">Document내의 모든 DOM node</span> </li>
                <li> RenderObject tree: <span style="font-size:20px">DOM node중에 화면에 보이는 node </span></li>
                <li> RenderLayer tree: <span style="font-size:20px">한번에 painting할 RenderObject 모음: stacking context</span> </li>
            </ol>
            <img height="410px" width="1000px" src="img/DOMTree-CPU-GPU.png">
        </div>
    </div>

    <div id="HWCompositingExample" class="step slide" data-x="5000" data-y="0">
        <h1 class="title">GPU 기반 합성 예제</h1>
        <div class="content">
            <ol>
                <li>
                    아래와 같이 주황색으로 표시된 Element는 HW Accelerated Compositing을 사용하는 GPU Texture로 mapping 후 rendering
                </li>
            </ol>
            <div class="gpuAC">
                나는 OpenGLES GPU가 합성합니다. 잘사용하면 CPU 합성과 비교되지 않게 빨라요. GPU가 접근하는 Texture라는 메모리에 살고 있습니다
            </div>
            <div class="gpuAC">
                DOM/Render Tree 복잡도 관점에는 최적화가 안되어 있어요
            </div>
        </div>
    </div>

    <div id="treeComplexity" class="step slide" data-x="6000" data-y="0">
        <h1 class="title">DOM/Render Tree 복잡도 관리: The More, The Slower</h1>
        <div class="content">
            <ol>
                <li>DOM node 및 RenderObject 개수는 최소화
                    <ul>
                        <li>DOM node 재활용: DOM node 상수 고정</li>
                        <li>동적으로 삽입/삭제</li>
                        <li>display:none 설정 -> 해당 Render Object 제거, DOM node 유지</li>
                        <li>visibility:hidden -> Tree 복잡도 유지, painting cost 절감</li>
                    </ul>
                </li>
                <li>animation동안 DOM 내용 변경 절대
                    <ul>
                        <li>
                            style 변경 -> layout -> painting -> bumpy animation
                        </li>
                    </ul>
                </li>
                <li>iframe으로 view 분리 (sandboxing)
                    <ul>
                        <li>
                            iframe으로 분리시 서로 분리된 frame(view)간 영향을 주지 않음
                        </li>
                        <li>
                            long-running app 개발시에도 메모리 leak 대응 용이
                        </li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <div id="HWCompositingReference" class="step slide" data-x="7000" data-y="0">
        <h1 class="title">WebKit 엔진의 설명 자료</h1>
        <div class="content">
            <ul>
                <li>
                    CPU에서 동작하는지 GPU에서 동작하는지 이해하고 활용 가능한 지식 필수
                </li>
                <li> 관련 자료들
                    <ul>
                        <li>
                            <a href="http://skpla.net/ScCT">WebKit 엔진 및 고성능 웹 앱 개발 (동영상) </a>
                        </li>
                        <li>
                            <a href="http://skpla.net/eTYB">WebKit 엔진 및 고성능 웹 앱 개발 (동영상) </a>
                        </li>
                        <li>
                            <a href="http://skpla.net/f58t">WebKit 엔진 및 고성능 웹 앱 개발 Best Practice (Slide)</a>
                        </li>
                        <li>
                            <a href="http://skpla.net/bWzP">HTML5 모바일 웹앱 개발 동향/사례/전망 (Slide)</a>
                        </li>

                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="gameBiz" class="step slide" data-x="-6000" data-y="3000">
        <h1 class="title">App-Embedded Branded Casual Game</h1>
        <div class="content">
            <ul>
                <li style="font-size:25px; padding:0">iOS/Android 동시 지원</li>
                <li style="font-size:25px; padding:0">App Embedded: App 사용자 retention</li>
                <li style="font-size:25px; padding:0">No 네이티브 앱 Update</li>
                <li style="font-size:25px; padding:0">30-50만명 실시간 랭킹</li>
            </ul>
            <img width="250px" src="./img/OCBAppFeed.png">
            <img width="250px" src="./img/CubeUI.png">
        </div>
    </div>

    <div id="canvasGameCore" class="step slide" data-x="-5000" data-y="3000">
        <h1 class="title">HTML5 canvas 기반 게임 개발</h1>
        <div class="content">
            <ul>
                <li>Browser 엔진을 게임 플랫폼으로 사용시 고려 사항
                    <ul>
                    <li>Rendering -> canvas, DOM, canvas/DOM Hybrid</li>
                    <li>Audio -> WebAudio/audio tag</li>
                    <li>Resource loader -> img tag/XHR</li>
                    <li>input -> touch </li>
                    <li>DPI 별 resource 관리</li>
                    </ul>
                </li>
                <li>기능별 제약 조건 분석후에 상용화 조건 부합시에만 사용
                </li>
            </ul>
        </div>
    </div>

    <div id="mobileGameEngine" class="step slide" data-x="-4000" data-y="3000">
        <h1 class="title">HTML5 canvas 기반 게임 개발</h1>
        <div class="content">
            <ul>
                <li>기존 오픈 소스 게임 엔진의 한계
                    <ul>
                        <li>PC 향 게임에 적합한 기능 및 크기</li>
                        <li>모바일 단말 성능 미고려로 Android 2.3을 포함한 상용화 수준 달성 힘듦
                    </ul>
                </li>
                <li>Mobile 단말 특화 필수 요건
                    <ul>
                        <li> Rendering 성능 최적화: 안정적인 20fps 이상(android 2.3 이상, iOS 5.0)</li>
                        <li> Play 가능한 interactive한 touch 반응성</li>
                        <li> garbage collection에 따른 게임 정지 최소화</li>
                    </ul>
                </li>
                <li>게임엔진 자체 개발
                    <ul>
                        <li> <a href="http://www.slideshare.net/senxation/html5-ok-33344593">SK 플래닛 HTML5 게임엔진소개</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="canvasGameLoop" class="step slide" data-x="-3000" data-y="3000">
        <h1 class="title">canvas 게임 기본 로직</h1>
        <div class="content">
            <ul>
                <li>책장 넘기 효과</li>
                <li>지우고 그리고 지우고를 반복 </li>
            </ul>
            <img height="380px" width="800px" src="./img/canvasGameLoop.png">
        </div>
    </div>

    <div id="gameObject" class="step slide" data-x="-2000" data-y="3000">
        <h1 class="title">Game내 Object 표현</h1>
        <div class="content">
            <ul>
                <li>Image 기반:
                    <ul>
                        <li>이미지의 crop/scaling up/down 조합</li>
                        <li>ctx.drawImage() 함수의 성능에 rendering 성능이 의존</li>
                        <img width="450px" src="./img/gallagaSprite.png">
                    </ul>
                </li>
                <li>Drawing primitive 조합:
                    <ul>
                        <li>최종 해상도 고려하여 path,circle,curve등을 조합하여 그리기</li>
                        <li>다단계 scaling을 피할수 있으나, Object 표현력의 한계로 디자인 제한적</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="gameObjectDrawingPrimitive" class="step slide" data-x="-2000" data-y="3000" data-rotate-y="90">
        <h1 class="title">Game내 Object 표현: Drawing Primitive 조합 방식 예제</h1>
        <div class="content">
            <ul>
                <li>최종 canvas 해상도 고려하여 path,circle,curve등을 조합하여 그리기 -> Image 방식 대비 상대적으로 성능 높음
                    <ul>
                        <li>
                            <a href="http://simeonvisser.hubpages.com/hub/HTML5-Tutorial-Drawing-Circles-and-Arcs">블로그 상세 설명</a>
                        </li>
                    </ul>
                </li>
                <img width="650px" src="./img/pacManDrawing.png">
            </ul>
        </div>
    </div>
    <div id="gameRunTime" class="step slide" data-x="-1000" data-y="3000">
        <h1 class="title">&#60;canvas&#62; RunTime의 Rendering 성능의 이해</h1>
        <div class="content">
            <ul>
                <li>Bottleneck은 "Image Rendering 성능"</li>
                <li>
                    <ul> 성능 Challenge
                        <li>canvas HW 가속 미지원: Android 2.3.x, iOS4.0 이하 -> DOM 방식이 개수가 적을때 canvas 방식보다 제한적으로 유리</li>
                        <li>Kitkat의 Chrome Webview(4.4, 4.4.2) 성능 재앙: 구글에 의한 희망에서 절망으로
                            <ul>
                                <li>4.4.3에서 해결됨, 그러나 4.4.2가 <span style="font-size:40px">60%</span> 시장 차지</li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
            <img height="220px" width="820px" src="./img/chromeWebviewIssue.png">
        </div>
    </div>

    <div id="canvasPerf" class="step slide" data-x="0" data-y="3000">
        <h1 class="title">상품화를 위한 성능 문제 정의</h1>
        <div class="content">
            <ul>
                <li>&#60;canvas&#62; HW 가속이 되지 않는 Android 2.3 및 4.4.2(Kitkat)에서 성능 향상 방법 </li>
            </ul>
        </div>
    </div>

    <div id="kitkatDister" class="step slide" data-x="1000" data-y="3000">
        <h1 class="title">Kitkat Webview 성능 분석</h1>
        <div class="content">
            <ul>
                <li>painting 면적, object 개수에 대한 painting 성능을 fps로 측정</li>
                <li>게임 &#60;canvas&#62;를 포함한 DOM Tree의 복잡도에 대한 영향 측정 </li>
                <li>실험 대상 단말: 옵티머스 G Pro(4.4.2), Nexus 5(4.4)</li>
            </ul>
        </div>
    </div>

    <div id="kitkatPerf1" class="step slide" data-x="1000" data-y="4300" data-scale="0.1">
        <h1 class="title">Kitkat Webview 성능 측정 결과</h1>
        <div class="content">
            <ul>
                <li>painting 면적, object 개수에 대한 painting 성능을 fps로 측정
                </li>
                <li>왼쪽 그래프: object 개수 1, painting 면적 증가</li>
                <li>오른쪽 그래: object 개수 증, painting 면적 25x25 고정</li>
            </ul>
            <img width="385px" src="./img/fullPartialRendering.png">
            <img width="385px" src="./img/fullPartialRendering2.png">
            <span>Kitkat browser에서는 해당 실험에서는 60fps로 성능 차이가 미미함</span>
        </div>
    </div>

    <div id="kitkatPerf2" class="step slide" data-x="1100" data-y="4300" data-scale="0.1">
        <h1 class="title">Kitkat Webview 성능 측정 결과</h1>
        <div class="content">
            <ul>
                <li>게임 &#60;canvas&#62;를 포함한 DOM Tree의 복잡도에 대한 영향 측정</li>
            </ul>
        </div>
        <img width="800px" src="./img/fullPartialRendering3.png">
    </div>

    <div id="kitkatPerf3" class="step slide" data-x="1200" data-y="4300" data-scale="0.1">
        <h1 class="title">Kitkat Webview 성능 측정 결과</h1>
        <div class="content">
            <ul>
                <li>DOM Tree 복잡도 증가시 비정상적인 성능 현상 발생</li>
            </ul>
        </div>
        <img width="800px" src="./img/DOMPerfSwing.png">
    </div>

    <div id="kitkatPerfConclusion" class="step slide" data-x="1300" data-y="4300" data-scale="0.1">
        <h1 class="title">Kitkat Webview 성능 분석 결과 정리
        </h1>
        <div class="content">
            <ul>
                <li>Painting 영역의 크기에 비례하여 성능에 성능 감소</li>
                <li>&#60;canvas&#62;를 내포한 페이지의 DOM Tree 노드가 증가
                    <ul><li>최대 100% 성능 감소 및 fps fluctuation 심하게 발생</li></ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="canvasDOMHybrid" class="step slide" data-x="2000" data-y="3000">
        <h1 class="title">성능 개선: DOM/Canvas Hybrid</h1>
        <div class="content">
            <ul>
                <li>애니메이션이 없는 게임 Object를 DOM으로 분리하여 GPU 가속을 사용하여 렌더링</li>
                <li>게임 엔진단에서 오브젝트별 rendering context를 DOM/Canvas 지정 가능</li>
            </ul>
            <img height="450px" width="900px" src="./img/DOMRendererCode.png">
        </div>
    </div>

    <div id="domPool" class="step slide" data-x="3000" data-y="3000">
        <h1 class="title">성능 개선: DOM/Canvas Hybrid</h1>
        <div class="content">
            <ul>
                <li> DOM Node Pool: DOM Renderer의 구현 최적화
                    <ul>
                        <li>Viewport 내의 게임 오브젝트를 담는 DOM노드를 Pool로 관리</li>
                        <li>애니메이션이 없으므로 Object 이미지도 재활용 필수 -> reset시 painting 발생으로 오히려 성능 저하</li>
                    </ul>
                </li>
            </ul>
            <img height="350px" width="600px" src="./img/DOMNodePool.png">
        </div>
    </div>

    <div id="smartREpaint" class="step slide" data-x="4000" data-y="3000">
        <h1 class="title">Invalidate 영역 관리</h1>
        <div class="content">
            <ul>
                <li>이전 Frame의 &#60;canvas&#62;를 지우지 않고 현재 Frame에 재활용</li>
                <li>Invalidate 영역만을 redraw
                    <ul>
                        <li>매 frame 마다 dirty object를 추적</li>
                    </ul>
                </li>
                <li>전체 화면을 깜빡이는 등의 animation은 기획 단계에서 배제</li>
            </ul>
            <div style="padding:30px;"></div>
            <img width="700px" src="./img/smartRepaint.png">
        </div>
    </div>

    <div id="imageDecodingOverhead" class="step slide" data-x="5000" data-y="3000">
        <h1 class="title">Source 이미지 크기 관리</h1>
        <div class="content">
            <ul>
                <li>Sprite 이미지 사용시 네트워크 요청 개수를 줄일수 있음. <br> 그러나,</li>
                <li>원본 이미지의 크기가 커지면 비례하여 crop하는 영역이 고정 크기여도 속도 저하
                    <ul><li>Kitkat단말 fps기준 10% 이내 정도</li></ul></li>
                <li>해결책: 자주 쓰이는 object는 개별 이미지로 분리</li>
            </ul>
            <br>
            <img height="200px" src="./img/gallagaSprite.png">
            <span>분리-></span>
            <img width="100px" src="./img/gallagaFire.png">
            <img height="100px" src="./img/gallagaMain.png">
        </div>
    </div>


    <div id="garbageCollection" class="step slide" data-x="6000" data-y="3000">
        <h1 class="title">Garbage Collection 최소화 1</h1>
        <div class="content">
            <ul>
                <li>게임내 모든 주요 Object는 Static Object Pool을 통해 관리</li>
                <li>Static Object 구현 방식에 따른 성능 차이<ul><li>Single Array, Double Array, Doubly Linked List</li></ul></li>
                <li><a href="http://jsperf.com/objectpool-performance-comparison">성능 비교 직접 해보기 </a></li>
            </ul>
            <img src="./img/sawtooth.png">
            <a href="https://speakerdeck.com/addyosmani/javascript-memory-management-masterclass"> JS 메모리 관리 by Addy Osamani </a>
        </div>
    </div>

    <div id="garbageCollectionPerf" class="step slide" data-x="6000" data-y="3500" data-rotate-y="90">
        <h1 class="title">Garbage Collection 최소화 2</h1>
        <div class="content">
            <ul>
                <li>Single Array: push/pop 사용시 가장 빠름 (splice 매우 느림)
                    <ul>
                        <li>GC를 완벽히 차단하는 것은 매우 어렵다</li>
                    </ul>
                </li>
            </ul>
            <img height="450px" width="700px" src="./img/StaticObjecPoolPerf.png">
        </div>
    </div>

    <div id="resolutionHandling" class="step slide" data-x="7000" data-y="3000">
        <h1 class="title">해상도 파헤치기</h1>
        <div class="content">
            <ul>
                <li>최종 화면에 하나의 Pixel이 그려지기 위해서는 실질적으로 다단계 이미지 Scale 발생
                    <ul>
                        <li>canvas.width, canvas.height</li>
                        <li>canvas.style.width, canvas.style.height</li>
                        <li>drawImage(원본 이미지 위치, destination scaled 위치)</li>
                        <li>window.devicePixelRatio</li>
                    </ul>
                </li>
                <li>원본 크기(canvas.width/height가 scale이 되지 않거나 또는 정수배 scale시 가장 성능이 좋음
                    <ul><li>현실적으로 단말별 해상도 차이 및 디자인 제약으로 쉽지 않음</li></ul>
                    </li>
            </ul>
        </div>
    </div>

    <div id="DOMComplexity" class="step slide" data-x="8000" data-y="3000">
        <h1 class="title">Game 실행 환경 분리 필수</h1>
        <div class="content">
            <ul>
                <li>canvas 게임을 Web Page에 embedding 시 canvas rendering 성능 저하
                    <ul><li>fps가 swing 하는 현상이 발생하며 30% 저하</li></ul>
                </li>
                <li>Web Page에 embed 시키지 말고 별도의 HTML로 실행
                    <ul>
                        <li>디자인/Publishing/게임 개발이 서로 다른 팀에서 결과물에 대해서 pipeline 형태로 작업시 발생 가능</li>
                        <li>위주 업체 제작: 700개 엘리먼트 --> 내부 제작: 350개 엘리먼트</li>
                        <li>10월 버전 부터는 게임 소개페이와 실행 페이지 분리 예정</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="conclusion" class="step slide" data-x="13000" data-y="2000" data-rotate-y="90" data-scale="2">
        <h1 class="title">핵심 메세지 정리</h1>
        <div class="content">
            <ul>
                <li>모바일 단말에서 30 fps 가능하도록 게임을 기획
                    <ul>
                        <li>게임 오브젝트, 디자인 요소, 배경, 애니메이션</li>
                    </ul>
                </li>
                <li>Browser 엔진에 대한 기본적인 이해는 성능 최적화에 필수적
                    <ul>
                        <li>canvas/DOM Hybrid, 이미지 사이즈 최적화, GPU 활용 등</li>
                    </ul>
                </li>
                <li>Inspector의 다양한 기능을 활용하여 최적화
                    <ul>
                        <li>
                            성능 분석 용이, 잔 실수를 사전에 차단
                        </li>
                </ul>
                </li>
            </ul>
        </div>
    </div>

</div>

<script src="js/impress.js"></script>
<script>
impress().init();
</script>
<script src="js/presentation.js"></script>

</body>
</html>
