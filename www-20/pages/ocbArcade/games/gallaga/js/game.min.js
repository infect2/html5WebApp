var LocalStorageManager=function(a){this.key=a};LocalStorageManager.prototype.save=function(a){window.localStorage.setItem(this.key,JSON.stringify(a))},LocalStorageManager.prototype.load=function(){var a;return a=JSON.parse(window.localStorage.getItem(this.key))},LocalStorageManager.prototype.clear=function(){window.localStorage.removeItem(this.key)},LocalStorageManager.prototype.allClear=function(){window.localStorage.clear()};/**
 * @preserve Alien Invations is originally developed by Pascal Ritt
 * which is found at https://github.com/cykod/AlienInvasion
 * Original MIT license is still hold for source code reuse/distribution
 */
var AlienInvasionGame=function(){var a=this,b={domBg:!1,clearRate:-1,skipCnt:0},c=[],d=[],e=!1,f={37:"left",39:"right",32:"fire"},g=1,h=2,i=4,j=8,k=16,l=13,m={ship:{sx:0,sy:0,w:64,h:60,sw:40,sh:40,frames:1},missile:{sx:192,sy:256,w:32,h:32,sw:24,sh:24,frames:1},enemy_missile:{sx:224,sy:256,w:32,h:32,sw:28,sh:36,frames:1},enemy_missile2:{sx:192,sy:288,w:32,h:32,sw:32,sh:32,frames:1},enemy_missile3:{sx:224,sy:288,w:32,h:32,sw:32,sh:32,frames:1},enemy_ship1:{sx:0,sy:64,w:64,h:64,sw:40,sh:40,frames:1},enemy_ship2:{sx:64,sy:64,w:64,h:64,sw:40,sh:40,frames:1},enemy_ship3:{sx:128,sy:64,w:64,h:64,sw:40,sh:40,frames:1},enemy_bee1:{sx:0,sy:128,w:64,h:64,sw:40,sh:40,frames:1},enemy_bee2:{sx:64,sy:128,w:64,h:64,sw:40,sh:40,frames:1},enemy_bug1:{sx:128,sy:128,w:64,h:64,sw:40,sh:40,frames:1},enemy_bug2:{sx:192,sy:128,w:64,h:64,sw:40,sh:40,frames:1},enemy_circle:{sx:192,sy:64,w:64,h:64,sw:32,sh:32,frames:1},enemy_boss:{sx:256,sy:0,w:256,h:226,sw:128,sh:114,frames:1},explosion:{sx:0,sy:320,w:64,h:64,sw:64,sh:64,frames:12},okcashbag:{sx:0,sy:192,w:64,h:64,sw:64,sh:64,frames:2}},n={enemy_boss:[{x:113,y:192,w:28,h:35},{x:99,y:170,w:58,h:43},{x:59,y:110,w:16,h:88},{x:180,y:107,w:16,h:88},{x:60,y:102,w:136,h:67},{x:27,y:3,w:202,h:100},{x:0,y:0,w:256,h:67}],enemy_ship1:[{x:31,y:58,w:2,h:6},{x:29,y:54,w:6,h:4},{x:27,y:46,w:10,h:8},{x:23,y:42,w:18,h:4},{x:19,y:0,w:26,h:42},{x:0,y:16,w:64,h:23}],enemy_ship2:[{x:31,y:58,w:2,h:6},{x:29,y:54,w:6,h:4},{x:27,y:46,w:10,h:8},{x:23,y:42,w:18,h:4},{x:19,y:0,w:26,h:42},{x:0,y:16,w:64,h:23}],enemy_ship3:[{x:31,y:58,w:2,h:6},{x:29,y:54,w:6,h:4},{x:27,y:46,w:10,h:8},{x:23,y:42,w:18,h:4},{x:19,y:0,w:26,h:42},{x:0,y:16,w:64,h:23}],enemy_circle:[{x:0,y:24,w:64,h:16},{x:5,y:19,w:54,h:26},{x:25,y:0,w:14,h:64},{x:20,y:4,w:24,h:56},{x:10,y:9,w:44,h:46}],ship:[{x:0,y:8,w:64,h:29},{x:27,y:0,w:10,h:60},{x:7,y:35,w:50,h:18},{x:23,y:54,w:18,h:6}],missile:[{x:15,y:8,w:4,h:15}],enemy_missile:[{x:14,y:11,w:4,h:9}],enemy_missile2:[{x:14,y:14,w:4,h:4}],enemy_missile3:[{x:14,y:14,w:4,h:4}]},o={boss:{behavior:"enemyBoss",x:0,y:-150,health:2500,points:1e5,E:15,missiles:10,missileType:"straight",missileSpeed:400,missileReload:5},straight:{behavior:"enemy",x:0,y:-50,health:10,points:100,E:100,missiles:1,missileType:"straight",missileSpeed:175,missileReload:1},ltr:{behavior:"enemy",x:0,y:-100,health:10,points:100,A:80,B:0,E:150,missiles:2,missileType:"straight",missileSpeed:175,missileReload:1},rtl:{behavior:"enemy",x:280,y:-100,health:10,points:100,A:-80,B:0,E:150,missiles:2,missileType:"straight",missileSpeed:175,missileReload:1},circlel:{behavior:"enemy",x:250,y:-50,health:10,points:100,A:0,B:-100,C:1,E:20,F:100,G:1,H:Math.PI/2,missiles:1,missileType:"straight",missileSpeed:175,missileReload:1},circler:{behavior:"enemy",x:250,y:-50,health:10,points:100,A:0,B:100,C:1,E:20,F:100,G:1,H:Math.PI/2,missiles:1,missileType:"straight",missileSpeed:175,missileReload:1},wiggle:{behavior:"enemy",x:100,y:-50,health:20,points:200,B:50,C:4,E:100,missiles:2,missileType:"straight",missileSpeed:175,missileReload:1},wave:{behavior:"enemy",x:0,y:-50,health:10,points:100,B:150,C:1.2,E:75,missiles:1,missileType:"straight",missileSpeed:175,missileReload:1},targete:{behavior:"enemy",x:0,y:-50,health:10,points:100,A:function(){var b=a.getBoard(6),c=b.detect(function(){return this.type===g?this:!1}),d=c.x+c.w/2,e=this.x+this.w/2;return(d-e)/p(3,8)},E:function(){return p(200,300)},missiles:0,missileType:"straight",missileSpeed:350,missileReload:1},okcashbag:{behavior:"item",reward:"missile",x:0,y:-50,points:500,B:30,C:4,E:100,missiles:0,missileType:"straight",missileSpeed:175,missileReload:1}},p=function(a,b){var c=b-a,d=Math.floor(Math.random()*(c+1));return b>c+a?b:a+d},q={},r=[[[1e3,1500,500,"enemy_ship1","straight",{x:function(){return q.l1=p(0,80),q.l1},missiles:0}],[1e3,1500,500,"enemy_ship1","straight",{x:function(){return q.l1+10+this.w},missiles:0}],[1e3,1500,500,"enemy_ship1","straight",{x:function(){return q.l1+20+2*this.w},missiles:0}],[3e3,3500,500,"enemy_ship1","straight",{x:function(){return q.l1=p(80,160),q.l1},missiles:0}],[3e3,3500,500,"enemy_ship1","straight",{x:function(){return q.l1+10+this.w},missiles:0}],[3e3,3500,500,"enemy_ship1","straight",{x:function(){return q.l1+20+2*this.w},missiles:0}],[5e3,5500,500,"enemy_ship1","straight",{x:function(){return q.l1=p(0,160),q.l1},missiles:0}],[5e3,5500,500,"enemy_ship1","straight",{x:function(){return q.l1+10+this.w},missiles:0}],[5e3,5500,500,"enemy_ship1","straight",{x:function(){return q.l1+20+2*this.w},missiles:0}],[9e3,2e4,500,"enemy_ship1","straight",{x:function(){return p(0,320-this.w)},missiles:0}],[1e4,10500,500,"okcashbag","okcashbag",{reward:"missile",x:function(){return p(0,320-this.w)}}]],[[1e3,1e4,500,"enemy_bug1","wave",{x:function(){return p(0,320-this.w)},A:0,B:50,C:4,D:0,E:120,health:10,points:10,missiles:1,missileReload:3}],[11e3,25e3,500,"enemy_ship2","straight",{x:function(){return p(0,160-this.w)},E:140,missiles:1,missileReload:5}],[13e3,13500,500,"okcashbag","okcashbag",{reward:"missileSpeed",x:function(){return p(0,320-this.w)}}],[11250,25250,500,"enemy_ship2","straight",{x:function(){return p(160,320-this.w)},E:130,missiles:1,missileSpeed:200,missileReload:5}]],[[1e3,7e3,700,"enemy_bee1","circlel",{x:100,health:20,points:200,missiles:1}],[1e3,7e3,700,"enemy_bee1","circler",{x:180,health:20,points:200,missiles:1}],[7e3,8e3,500,"enemy_bug1","straight",{x:function(){return q.l1=p(0,80)},health:20,points:200,missiles:0}],[7e3,8e3,500,"enemy_bug1","straight",{x:function(){return q.l1+10+this.w},health:20,points:200,missiles:0}],[7e3,8e3,500,"enemy_bug1","straight",{x:function(){return q.l1+20+2*this.w},health:20,points:200,missiles:0}],[1e4,11e3,500,"enemy_bug1","straight",{x:function(){return q.l1=p(80,160)},health:20,points:200,missiles:0}],[1e4,11e3,500,"enemy_bug1","straight",{x:function(){return q.l1+10+this.w},health:20,points:200,missiles:0}],[1e4,11e3,500,"enemy_bug1","straight",{x:function(){return q.l1+20+2*this.w},health:20,points:200,missiles:0}],[10500,11e3,500,"okcashbag","okcashbag",{reward:"missile",x:function(){return p(0,320-this.w)}}],[15e3,25e3,1e3,"enemy_bug2","straight",{x:function(){return q.l1=p(0,160)},E:150,health:30,points:300,missiles:2,missileReload:5,missileSpeed:180}],[15e3,25e3,1e3,"enemy_bug2","straight",{x:function(){return q.l1+10+this.w},E:150,health:30,points:300,missiles:2,missileReload:5,missileSpeed:180}],[15e3,25e3,1e3,"enemy_bug2","straight",{x:function(){return q.l1+20+2*this.w},E:150,health:30,points:300,missiles:2,missileReload:5,missileSpeed:180}]],[[0,5e3,500,"enemy_ship3","targete",{x:function(){return p(10,310-this.w)},health:20,points:200,E:function(){return p(175,250)},missiles:1,missileSpeed:275}],[5e3,15e3,300,"enemy_ship3","targete",{x:function(){return p(10,310-this.w)},health:20,points:200,E:function(){return p(200,300)},missiles:1,missileSpeed:325}],[5500,6e3,500,"okcashbag","okcashbag",{reward:"missileReload",x:function(){return p(0,320-this.w)}}],[15e3,3e4,200,"enemy_ship3","targete",{x:function(){return p(10,310-this.w)},health:20,points:200,E:function(){return p(300,350)},missiles:1,missileSpeed:350}]],[[0,35e3,300,"enemy_circle","wave",{x:function(){return p(0,320-this.w)},A:0,B:50,C:4,D:0,E:120,health:30,points:10,missiles:0}],[5e3,15e3,2e3,"enemy_bee2","straight",{x:function(){return p(0,320-this.w)},E:function(){return p(120,150)},health:20,points:100,missiles:1,missileReload:3}],[5e3,5500,500,"enemy_boss","boss",{x:p(0,110)}],[7e3,7500,500,"okcashbag","okcashbag",{reward:"missile",x:function(){return p(0,320-this.w)}}],[17e3,35e3,1e3,"enemy_bug2","targete",{x:function(){return p(0,320-this.w)},E:function(){return p(150,200)},health:30,points:300,missileSpeed:250,missiles:2,missileReload:5}]]],s=function(){var c=navigator.userAgent.toLowerCase();c.match(/android/)?a.setBoard(0,new w(50,.6,80,!b.domBg)):(a.setBoard(0,new w(20,.4,80,!0)),a.setBoard(1,new w(50,.6,40)),a.setBoard(2,new w(100,1,20)))},t=function(){e=!1,a.disableBoard(6),a.disableBoard(7),$(".gameCanvas").trigger("finish",a.getBoard(4).points)};this.initialize=function(c,d,f){return this.canvas="string"==typeof c?document.getElementById(c):c,this.canvas.style.width=f.width+"px",this.canvas.style.height=f.height+"px",this.width=this.canvas.width,this.height=this.canvas.height,this.scale={},this.scale.x=parseInt(this.canvas.style.width||this.canvas.width,10)/320,this.scale.y=parseInt(this.canvas.style.height||this.canvas.height,10)/400,this.playerOffset=32,this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),this.ctx?(function(){var c=window.navigator.userAgent;/Android 2/i.test(c)&&"undefined"==typeof a.ctx.flush&&(b.domBg=!0,b.clearRate=-2),/Android 4.0/i.test(c)&&(b.domBg=!0)}(),b.domBg&&($(this.canvas).css({background:"#000","-webkit-transform":"translateZ(0)"}),$(this.canvas).wrapAll("<div>").parent().css({height:"399px",overflow:"hidden"}).parent().css({backgroundColor:"#2f2f2f"})),v.load(m,s,d),this.setupInput(),this.loop(),void(e=!0)):alert("Please upgrade your browser to play")},this.playGame=function(){new z(r,t);this.disableBoard(4),this.disableBoard(5),this.disableBoard(6),this.disableBoard(7),this.board=new x,this.level=new z(r,t),this.board.add(new C),this.board.add(this.level),this.level.next(),this.setBoard(4,new A(0)),this.setBoard(5,new y("Level "+(this.level.stage+1))),this.setBoard(6,this.board)},this.keys={},this.setupInput=function(){window.addEventListener("keydown",function(b){f[event.keyCode]&&(a.keys[f[event.keyCode]]=!0,b.preventDefault())},!1),window.addEventListener("keyup",function(b){f[event.keyCode]&&(a.keys[f[event.keyCode]]=!1,b.preventDefault())},!1),a.controller=Object.create(PubSub.prototype),function(){var b,c,d;a.canvas.addEventListener("dblclick",function(a){a.preventDefault()},!0),a.canvas.addEventListener("click",function(a){a.preventDefault()},!0),a.canvas.addEventListener("touchstart",function(c){var d=c.targetTouches[0],e=d.pageX/a.scale.x,f=d.pageY/a.scale.y-a.canvas.offsetTop;f>a.height/2&&(c.preventDefault(),c.stopPropagation()),b=e,a.keys.fire=!0},!0),a.canvas.addEventListener("touchmove",function(e){var f=e.targetTouches[0],g=f.pageX/a.scale.x;c=g-b,b=g,a.controller.trigger("move",c),d&&clearTimeout(d),d=setTimeout(function(){a.controller.trigger("move",0)},100)},!0),a.canvas.addEventListener("touchend",function(){a.keys.fire=!1},!0)}(),this.trackTouch=function(b){var c,d,e;a.keys.left=!1,a.keys.right=!1;for(var f=0;f<b.targetTouches.length;f++)c=b.targetTouches[f],d=c.pageX/a.scale.x-a.canvas.offsetLeft,e=c.pageY/a.scale.y-a.canvas.offsetTop,e<a.height/2||(b.preventDefault(),d<a.width/2&&(a.keys.left=!0),d>a.width/2&&(a.keys.right=!0))}};var u=(new Date).getTime();this.loop=function(){var b=(new Date).getTime();requestAnimationFrame(a.loop);var f=(b-u)/1e3;if(e)for(var g=0,h=c.length;h>g;g++)c[g]&&d[g]&&(c[g].step(f),c[g].draw(a.ctx));a.ctx.flush&&a.ctx.flush(),u=b},this.captureScreenShot=function(){for(var b=0,d=c.length;d>b;b++)c[b]&&c[b].draw(a.ctx);return a.canvas.toDataURL()},this.setBoard=function(a,b){this.disableBoard(a),c[a]=b,this.enableBoard(a)},this.getBoardNum=function(a){return"number"!=typeof a?c.indexOf(a):a},this.getBoard=function(a){return c[this.getBoardNum(a)]},this.enableBoard=function(a){d[this.getBoardNum(a)]=!0},this.disableBoard=function(a){d[this.getBoardNum(a)]=!1};var v=function(){return this.map={},this.load=function(a,b,c){this.map=a,this.image=new Image,this.image.onload=b,this.image.src=c},this.draw=function(b,c,d,e,f){var g,h,i=this.map[c];f||(f=0),d=Math.floor(d),e=Math.floor(e),g=i.sw||i.w,h=i.sh||i.h,d>a.width||0>d+g||e>a.height||0>e+h||b.drawImage(this.image,i.sx+f*i.w,i.sy,i.w,i.h,d,e,g,h)},this}.call(v),w=function(c,d,e,f){var g=document.createElement("canvas");g.width=a.width,g.height=a.height;var h=g.getContext("2d"),i=0;f&&(h.fillStyle="#000",h.fillRect(0,0,g.width,g.height)),h.fillStyle="#999",h.globalAlpha=d;for(var j=0;e>j;j++)h.fillRect(Math.floor(Math.random()*g.width),Math.floor(Math.random()*g.height),p(1,2),p(1,2));this.draw=function(a){var c=Math.floor(i),d=g.height-c;b.domBg&&(b.skipCnt++,b.skipCnt>0&&(a.clearRect(0,0,g.width,g.height-1),b.skipCnt=b.clearRate)),c>0&&a.drawImage(g,0,d,g.width,c,0,0,g.width,c),d>0&&a.drawImage(g,0,0,g.width,d,0,c,g.width,d)},this.step=function(a){i+=a*c,i%=g.height}},x=function(){var a=this;this.objects=[],this.removed=[],this.cnt={},this.cnt[g]=0,this.cnt[h]=0,this.cnt[i]=0,this.cnt[j]=0,this.cnt[l]=0,this.cnt[k]=0,this.add=function(a){return a.board=this,this.objects.push(a),"undefined"!=typeof a.type&&(this.cnt[a.type]=(this.cnt[a.type]||0)+1),a},this.remove=function(a){var b=this.removed.indexOf(a);return-1===b?(this.removed.push(a),!0):!1},this.finalizeRemoved=function(){for(var a=0,b=this.removed.length;b>a;a++){var c=this.objects.indexOf(this.removed[a]);-1!==c&&(this.cnt[this.removed[a].type]--,this.objects.splice(c,1))}this.removed=[]},this.iterate=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=this.objects.length;d>c;c++){var e=this.objects[c];e&&e[a].apply(e,b)}},this.detect=function(a){for(var b=0,c=this.objects.length;c>b;b++)if(-1===this.removed.indexOf(this.objects[b])&&a.call(this.objects[b]))return this.objects[b];return!1},this.step=function(a){this.iterate("step",a),this.finalizeRemoved()},this.draw=function(a){this.iterate("draw",a)},this.overlap=function(a,b){return!(a.y+a.h<b.y||a.y>b.y+b.h||a.x+a.w<b.x||a.x>b.x+b.w)},this.collide=function(b,c){return this.detect(function(){if(b!==this){if(this.type===c){var d=b.collides.map(function(a){return{x:this.x+a.x,y:this.y+a.y,w:a.w,h:a.h}},b),e=this.collides.map(function(a){return{x:this.x+a.x,y:this.y+a.y,w:a.w,h:a.h}},this);return d.some(function(b){return e.some(function(c){return a.overlap(b,c)},this)},this)}return!1}})},this.clear=function(){this.objects.forEach(function(a){"undefined"==typeof a.type||a.type!==h&&a.type!==j||this.remove(a)},this),this.finalizeRemoved()}},y=function(b){var c=0;this.step=function(a){c+=a},this.draw=function(c){c.fillStyle="#FFFFFF";var d=18;c.font="bold "+d+"px sans-serif";var e=c.measureText(b.toUpperCase());c.fillText(b.toUpperCase(),a.width-e.width-10,20)}},z=function(a,b){this.stage=-1,this.stages=[];for(var c=0;c<a.length;c++)this.stages.push(Object.create(a[c]));this.callback=b};z.prototype.next=function(){if(!(this.stages.length-1<this.stage)){this.t=-1e3,this.endTime=1/0,this.stage+=1,this.levelData=[];for(var a=0;a<this.stages[this.stage].length;a++)this.levelData.push(Object.create(this.stages[this.stage][a]))}},z.prototype.step=function(b){var c=0,d=[],e=null;for(this.t+=1e3*b;(e=this.levelData[c])&&e[0]<this.t+2e3;){if(this.t>e[1])d.push(e);else if(e[0]<this.t){var f,h=$.extend({},o[e[4]],e[5]),k=e[3];switch(h.behavior){case"enemy":case"enemyBoss":f=new E(k,h);break;case"item":f=new H(k,h)}this.board.add(f),e[0]+=e[2]}c++}for(var m=0,n=d.length;n>m;m++){var p=this.levelData.indexOf(d[m]);-1!==p&&this.levelData.splice(p,1)}0===this.levelData.length&&1===this.board.cnt[g]&&0===this.board.cnt[i]&&0===this.board.cnt[j]&&0===this.board.cnt[l]&&1/0===this.endTime&&(this.endTime=this.t),this.endTime+3e3<this.t&&(this.stage===this.stages.length-1?this.callback&&this.callback(!0):(this.next(),a.setBoard(5,new y("Level "+(this.stage+1)))))},z.prototype.draw=function(){};var A=function(){this.points=0,this.comboPoints=0;var a=8;this.draw=function(b){b.save();var c=18;b.font="bold "+c+"px sans-serif",b.fillStyle="#FFFFFF";for(var d=""+this.points,e=a-d.length,f="";e-->0;)f+="0";b.fillText(f+d,10,20),b.restore()},this.step=function(){}},B=function(){};B.prototype.setup=function(a,b){this.sprite=a,this.merge(b),this.frame=this.frame||0,this.w=v.map[a].sw||v.map[a].w,this.h=v.map[a].sh||v.map[a].h;var c=this.w/v.map[a].w,d=this.h/v.map[a].h;this.collides=n[a]?n[a].map(function(a){return{x:a.x*c,y:a.y*d,w:a.w*c,h:a.h*d}}):[{x:0,y:0,w:v.map[a].w*c,h:v.map[a].h*d}]},B.prototype.merge=function(a){if(a)for(var b in a)this[b]=a[b]},B.prototype.draw=function(a){a.globalAlpha=this.alpha||1,v.draw(a,this.sprite,this.x,this.y,this.frame),a.globalAlpha=1},B.prototype.step=function(){},B.prototype.hit=function(){this.board.remove(this)};var C=function(){this.setup("ship",{vx:0,damage:300,missileReload:.2,missile:1,missileSpeed:-300}),a.controller.on("move",function(b){b=0>b?Math.max(b,-this.w):Math.min(b,this.w),this.vx=b,this.lastx=this.x,this.x+=this.vx,this.x=Math.min(Math.max(this.x,0),a.width-this.w)}.bind(this)),this.reload=this.missileReload,this.x=this.lastx=a.width/2-this.w/2,this.y=a.height-a.playerOffset-this.h,this.step=function(a){var b=this.board.collide(this,i);b&&(b.hit(this.damage),this.hit(b.damage));var c=this.board.collide(this,j);c&&(this.board.remove(c),this.hit(c.damage)),this.reload-=a,this.reload<0&&(this.reload=this.missileReload,1===this.missile?this.board.add(new D(this.x+this.w/2,this.y+7,this.missileSpeed)):2===this.missile?(this.board.add(new D(this.x+0+1,this.y+12,this.missileSpeed)),this.board.add(new D(this.x+this.w-1,this.y+12,this.missileSpeed))):3===this.missile?(this.board.add(new D(this.x+0+1,this.y+12,this.missileSpeed)),this.board.add(new D(this.x+this.w/2,this.y+7,this.missileSpeed)),this.board.add(new D(this.x+this.w-1,this.y+12,this.missileSpeed))):4===this.missile&&(this.board.add(new D(this.x+0+1,this.y+12,this.missileSpeed)),this.board.add(new D(this.x+this.w/3*1,this.y+7,this.missileSpeed)),this.board.add(new D(this.x+this.w/3*2,this.y+7,this.missileSpeed)),this.board.add(new D(this.x+this.w-1,this.y+12,this.missileSpeed))))}};C.prototype=new B,C.prototype.type=g,C.prototype.hit=function(){this.board.remove(this)&&(this.board.add(new G(this.x+this.w/2,this.y+this.h/2)),setTimeout(function(){t(!1)},2e3))},C.prototype.enhance=function(a){switch(a){case"missile":this.missile+=1,this.missile=Math.min(this.missile,4);break;case"missileSpeed":this.missileSpeed-=200,this.missileSpeed=Math.max(this.missileSpeed,-500);break;case"missileReload":this.missileReload-=.75,this.missileReload=Math.max(this.missileReload,.125)}};var D=function(a,b,c){this.setup("missile",{vy:c||-300,damage:10}),this.x=a-this.w/2,this.y=b-this.h};D.prototype=new B,D.prototype.type=h,D.prototype.step=function(a){this.y+=this.vy*a;var b=this.board.collide(this,i);b?(b.hit(this.damage),this.board.remove(this)):this.y<-this.h&&this.board.remove(this)};var E=function(a,b){this.merge(this.baseParameters),this.setup(a,b),["x","y","A","B","E","F"].forEach(function(a){"function"==typeof this[a]&&(this[a]=this[a].call(this))},this),this.healthLast=this.health,this.reload=1.5*Math.random()};E.prototype=new B,E.prototype.type=i,E.prototype.baseParameters={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,t:0,missileReload:1,reload:0,damaga:100},E.prototype.step=function(b){this.t+=b,this.vx=this.A+this.B*Math.sin(this.C*this.t+this.D),this.vy=this.E+this.F*Math.sin(this.G*this.t+this.H),this.x+=this.vx*b,this.y+=this.vy*b,this.reload<=0&&(this.reload=this.missileReload,this.missiles>0&&(1===this.missiles?this.board.add(new F(this.x+this.w/2,this.y+this.h,this.missileSpeed)):2===this.missiles?(this.board.add(new F(this.x+1,this.y+this.h,this.missileSpeed)),this.board.add(new F(this.x+this.w-1,this.y+this.h,this.missileSpeed))):10===this.missiles&&(this.board.add(new F(this.x+1,this.y+this.h-75,this.missileSpeed)),this.board.add(new F(this.x+this.w/10,this.y+this.h-45,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*2,this.y+this.h-30,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*3,this.y+this.h-15,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*4,this.y+this.h,this.missileSpeed)),this.board.add(new F(this.x+this.w/2,this.y+this.h,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*6,this.y+this.h,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*7,this.y+this.h-15,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*8,this.y+this.h-30,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*9,this.y+this.h-45,this.missileSpeed)),this.board.add(new F(this.x+this.w-1,this.y+this.h-75,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*3,this.y+this.h-75,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*4,this.y+this.h-55,this.missileSpeed)),this.board.add(new F(this.x+this.w/2,this.y+this.h-45,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*6,this.y+this.h-55,this.missileSpeed)),this.board.add(new F(this.x+this.w/10*7,this.y+this.h-75,this.missileSpeed))))),this.reload-=b,this.y>a.height&&(this.board.remove(this),a.getBoard(4).comboPoints=0)},E.prototype.hit=function(b){this.healthLast-=b,this.alpha=this.healthLast/this.health*.5+.5;var c=a.getBoard(4);if(this.healthLast<=0&&this.board.remove(this))if(c.points+=(this.points||100)+c.comboPoints,c.comboPoints=Math.min(c.comboPoints+10,1e3),"enemyBoss"===this.behavior)for(var d=0,e=this,f=function(){e.board.add(new G(p(e.x,e.x+e.w),p(e.y,e.y+e.h)))},g=0;20>g;g++)setTimeout(f,d+=150);else this.board.add(new G(this.x+this.w/2,this.y+this.h/2))};var F=function(a,b,c){this.setup("enemy_missile",{vy:c||200,damage:10}),this.x=a-this.w/2,this.y=b};F.prototype=new B,F.prototype.type=j,F.prototype.step=function(b){this.y+=this.vy*b,this.y>a.height&&this.board.remove(this)};var G=function(a,b){this.setup("explosion",{frame:0}),this.x=a-this.w/2,this.y=b-this.h/2};G.prototype=new B,G.prototype.type=l,G.prototype.step=function(){this.frame++,this.frame>=12&&this.board.remove(this)};var H=function(a,b){this.merge(this.baseParameters),this.setup(a,b),this.frameNum=0,["x","y","A","B","E","F"].forEach(function(a){"function"==typeof this[a]&&(this[a]=this[a].call(this))},this)};return H.prototype=new B,H.prototype.type=k,H.prototype.baseParameters={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,t:0},H.prototype.step=function(b){this.t+=b,this.vx=this.A+this.B*Math.sin(this.C*this.t+this.D),this.vy=this.E+this.F*Math.sin(this.G*this.t+this.H),this.x+=this.vx*b,this.y+=this.vy*b;var c=this.board.collide(this,g);c&&(c.enhance(this.reward),this.board.remove(this)),(this.y>a.height||this.x<-this.w||this.x>a.width)&&this.board.remove(this),this.frameNum+=1,8===this.frameNum&&(this.frameNum=0),this.frame=Math.floor(this.frameNum/4)},this}.call({});!function(){Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),isNaN||(window.isNaN=function(a){return a!==a}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var a=window.PubSub=function(){};a.prototype.trigger=function(a,b){"undefined"==typeof this._eventHandlers&&(this._eventHandlers=[]);var c,d,e=[];for(c=0;c<this._eventHandlers.length;c++)if(this._eventHandlers[c].name===a){for(d=0;d<this._eventHandlers[c].fn.length;d++)e.push(this._eventHandlers[c].fn[d].call(this,b));break}for(c=0;c<e.length;c++)if(e[c]===!1)return!1;return!0},a.prototype.on=function(a,b){var c,d=-1;if("undefined"==typeof this._eventHandlers&&(this._eventHandlers=[]),"undefined"==typeof b&&"string"!=typeof a){for(var e in a)this.on(e,a[e]);return this}for(c=0;c<this._eventHandlers.length;c++)this._eventHandlers[c].name===a&&(d=c);return 0>d?this._eventHandlers.push({name:a,fn:[b]}):this._eventHandlers[d].fn.push(b),this}}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(a,b,c){function d(a){var b,c,d,e,f,g=[{levelDesc:"초하수",levelID:"lv-6",startPnt:0,endPnt:2800,startRate:97,endRate:100},{levelDesc:"하수",levelID:"lv-5",startPnt:2801,endPnt:15630,startRate:84,endRate:97},{levelDesc:"중수",levelID:"lv-4",startPnt:15631,endPnt:79e3,startRate:16,endRate:84},{levelDesc:"고수",levelID:"lv-3",startPnt:79001,endPnt:137080,startRate:4,endRate:16},{levelDesc:"초고수",levelID:"lv-2",startPnt:137081,endPnt:308420,startRate:.1,endRate:3},{levelDesc:"신(神)",levelID:"lv-1",startPnt:308421,endPnt:"Infinity",startRate:0,endRate:.1}],h=g.length;for(c=0;h>c;c++)if(b=g[c],!(b.startPnt>a||b.endPnt<a)){d=b.levelDesc,e=b.levelID,f=function(){var c,d=(b.endRate-b.startRate)/(b.endPnt-b.startPnt);return c=b.endRate-d*(a-b.startPnt),.1>=c&&(c=.1),c>100&&(c=100),c>.1&&(c=10*c,c=Math.ceil(c),c/=10),c.toString()}();break}return console.log(d),console.log(e),console.log(f),{levelDesc:d,levelID:e,rate:f}}var e,f,g=navigator.userAgent.toLowerCase(),h=function(){var c;if(AlienInvasionGame.initialize(b("._gameCanvas").get(0),"images/sp.png",{width:320,height:400}),!/Android 2/i.test(g)&&(f=new LocalStorageManager("gallaga"),c=f.load(),e=null===c?0:c.score,b(".bestScore").text(e),b(".game_ranking").css("height",a.innerHeight-400+"px"),e>0)){var h={},i=d(e);h.score=e,h.level=i.levelID,h.rate=i.rate,f.save(h)}},i=function(){AlienInvasionGame.playGame()};b(".gameCanvas").on("finish",function(a,c){var h={},i=d(c);b(".p2 strong").addClass(i.levelID),b(".p1 strong").text(i.rate),b(".game-result").removeClass("hidden"),h.score=c,h.level=i.levelID,h.rate=i.rate,c>e&&(/Android 2/i.test(g)||f.save(h),b(".bestScore").text(c))}),b(".restartBtn").on("click",function(b){b.preventDefault(),a.location.reload()}),b(".backBtn").on("click",function(){a.location.href="http://egame.skmcgw.com/planetArcade/client/index.html"}),b(c).ready(function(){h(),i()})}(window,jQuery,document);